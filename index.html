<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cálculo cotas tubería y coordenadas</title>

  <style>
    :root{
      --bg:#f6f7fb;
      --card:#ffffff;
      --text:#111827;
      --muted:#6b7280;
      --line:rgba(17,24,39,.12);
      --shadow: 0 10px 25px rgba(0,0,0,.08);
      --accent:#2563eb;
      --accent2:#1d4ed8;
    }

    *{
      box-sizing:border-box;
      font-family: "Century Gothic","CenturyGothic","AppleGothic",system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;
    }

    body{
      margin:0;
      background: var(--bg);
      color:var(--text);
    }

    .wrap{
      max-width:1400px;
      margin:24px auto;
      padding:0 16px 60px;
    }

    header{
      display:flex;
      gap:14px;
      align-items:flex-start;
      justify-content:space-between;
      flex-wrap:wrap;
      margin-bottom:10px;
    }

    .brand{
      display:flex;
      gap:14px;
      align-items:center;
    }

    .brand img{
      width:54px; height:54px; object-fit:contain;
      border-radius:14px;
      border:1px solid var(--line);
      background:#fff;
      padding:6px;
      box-shadow: 0 6px 16px rgba(0,0,0,.10);
    }

    h1{ margin:0; font-size:20px; letter-spacing:.2px; }
    .sub{ margin:6px 0 0; color:var(--muted); font-size:13px; max-width:980px; }

    .toolbar{
      display:flex; gap:10px; flex-wrap:wrap; align-items:center;
    }

    .pill{
      display:inline-flex; padding:6px 10px;
      border:1px solid var(--line);
      border-radius:999px;
      font-size:12px;
      color:var(--muted);
      gap:8px; align-items:center;
      background:#fff;
      box-shadow: 0 6px 16px rgba(0,0,0,.06);
    }
    .dot{ width:8px; height:8px; border-radius:50%; background:#16a34a; display:inline-block; }
    .dot.warn{ background:#f59e0b; }

    button{
      border:1px solid var(--line);
      background:#fff;
      color:var(--text);
      padding:10px 12px;
      border-radius:12px;
      cursor:pointer;
      font-weight:700;
      font-size:13px;
      box-shadow: 0 6px 16px rgba(0,0,0,.06);
    }
    button:hover{ border-color:rgba(17,24,39,.25); }

    button.primary{
      background: linear-gradient(180deg, rgba(37,99,235,.95), rgba(29,78,216,.95));
      border-color: rgba(29,78,216,.65);
      color:#fff;
      box-shadow: 0 12px 25px rgba(29,78,216,.18);
    }

    .grid{
      display:grid;
      grid-template-columns: 1.05fr 1.6fr;
      gap:14px;
      margin-top:14px;
    }
    @media (max-width: 1100px){
      .grid{ grid-template-columns:1fr; }
    }

    .card{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:16px;
      padding:14px;
      box-shadow: var(--shadow);
      position:relative;
    }

    .card h2{
      margin:0 0 10px;
      font-size:13px;
      color:var(--muted);
      font-weight:800;
      text-transform:uppercase;
      letter-spacing:.12em;
    }

    .kv{
      display:grid;
      grid-template-columns: 1fr 260px;
      gap:10px 14px;
    }
    .kv .k{ color:var(--text); font-weight:700; font-size:13px; }
    .kv .v{
      color:var(--text);
      font-variant-numeric: tabular-nums;
      text-align:right;
      padding:7px 10px;
      border:1px solid rgba(17,24,39,.10);
      border-radius:12px;
      background:#f9fafb;
    }
    .v.empty{ color: rgba(17,24,39,.45); }

    .hint{ margin-top:10px; color:var(--muted); font-size:12px; }

    .table-wrap{
      overflow:auto;
      max-height:610px;
      border-radius:14px;
      border:1px solid rgba(17,24,39,.10);
      background:#fff;
    }

    table{ width:100%; border-collapse:separate; border-spacing:0; }
    thead th{
      text-align:left;
      font-size:12px;
      color:var(--muted);
      padding:10px 10px;
      border-bottom:1px solid rgba(17,24,39,.10);
      position:sticky;
      top:0;
      background:#ffffff;
      z-index:1;
      white-space:nowrap;
    }
    tbody td{
      padding:10px;
      border-bottom:1px solid rgba(17,24,39,.08);
      font-size:13px;
      white-space:nowrap;
    }
    tbody tr:hover td{ background:#f9fafb; }
    .num{ text-align:right; font-variant-numeric: tabular-nums; }
  </style>
</head>

<body>
<div class="wrap">

<header>
  <div class="brand">
    <img src="Logo.png" alt="Logo">
    <div>
      <h1>Cálculo cotas tubería y coordenadas</h1>
      <p class="sub">
        Herramienta para cálculo de cotas y coordenadas de tubería por pendiente y geometría real.
      </p>
    </div>
  </div>

  <div class="toolbar">
    <button class="primary" id="btnBasic">Editar datos básicos</button>
    <button id="btnCSV">Exportar CSV</button>
    <button id="btnClear">Limpiar</button>
  </div>
</header>

<section class="grid">
  <div class="card">
    <h2>Datos básicos</h2>
    <div class="kv" id="basicKV"></div>
  </div>

  <div class="card">
    <h2>Tabla de resultados</h2>
    <div class="table-wrap">
      <table>
        <thead>
        <tr>
          <th>Punto</th>
          <th>Abs</th>
          <th class="num">Dist (m)</th>
          <th class="num">Cota Lomo</th>
          <th class="num">Cota Excavación</th>
          <th class="num">Cota Gravilla</th>
          <th class="num">Norte</th>
          <th class="num">Este</th>
          <th>Tubo</th>
        </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>
  </div>
</section>

</div>

<script>
const ABS_START_M = 0.600;
const ABS_END_BOX = 0.400;
const ABS_PREFIX = "K0+";

const state = { basic:{}, rows:[] };

function fmt(n,d=3){ return isFinite(n)?Number(n).toFixed(d):""; }

function absToText(m){
  const s = m.toFixed(3).split(".");
  return `${ABS_PREFIX}${s[0].padStart(3,"0")}.${s[1]}`;
}

function calcGeomLen(n0,e0,n1,e1){
  return Math.hypot(n1-n0,e1-e0);
}

function regenerateTable(){
  const b = state.basic;
  const slope = b.pendiente/100;
  const outer = b.diametro + 2*b.espesor;

  const Lgeom = calcGeomLen(b.nPozo,b.ePozo,b.nCaja,b.eCaja);
  const Leff = Lgeom - (ABS_START_M + ABS_END_BOX);
  const nT = Math.floor(Leff / b.longTubo);

  const uN = (b.nCaja-b.nPozo)/Lgeom;
  const uE = (b.eCaja-b.ePozo)/Lgeom;

  state.rows = [];

  for(let k=0;k<=nT;k++){
    const dist = ABS_START_M + k*b.longTubo;

    const cotaLomo = b.cotaPozo + slope*dist;
    const cotaExc  = cotaLomo - outer - 0.15;
    const cotaGrav = cotaExc + 0.15;

    state.rows.push({
      punto:k+1,
      abs:absToText(dist),
      dist,
      cotaLomo,
      cotaExc,
      cotaGrav,
      norte:b.nPozo + uN*dist,
      este:b.ePozo + uE*dist,
      tubo:k<nT?`Tubo ${k+1}`:""
    });
  }
}

function render(){
  const tb=document.getElementById("tbody");
  tb.innerHTML="";
  state.rows.forEach(r=>{
    tb.innerHTML+=`
    <tr>
      <td>${r.punto}</td>
      <td>${r.abs}</td>
      <td class="num">${fmt(r.dist)}</td>
      <td class="num">${fmt(r.cotaLomo)}</td>
      <td class="num">${fmt(r.cotaExc)}</td>
      <td class="num">${fmt(r.cotaGrav)}</td>
      <td class="num">${fmt(r.norte)}</td>
      <td class="num">${fmt(r.este)}</td>
      <td>${r.tubo}</td>
    </tr>`;
  });
}
</script>

</body>
</html>
